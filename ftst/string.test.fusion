// Copyright (c) 2013-2014 Amazon.com, Inc.  All rights reserved.

(require
  "/fusion/experimental/check"
  "/fusion/experimental/string"
  "/fusion/string")


// Here's the bindings we expect to be available:
(module check_bindings '/fusion/string'
  [ is_string,
    string_append, string_to_lower, string_to_symbol, string_to_upper,
  ])


//============================================================================
// Comparisons

(define_check (check_comparisons lo hi)
//  (check <  lo hi)  TODO FUSION-243 string ordering
//  (check <= lo hi)
  (check =  lo lo)
  (check =  hi hi)
//  (check >= hi lo)
//  (check >  hi lo)
)

(check_comparisons ""  "a")
(check_comparisons "a" "b")

(check_comparisons (quote f::"" ) (quote e::"a"))
(check_comparisons (quote f::"a") (quote e::"b"))


//============================================================================
// string_append

(check === ""    (string_append ""   ""))
(check === "aB"  (string_append "aB" ""))
(check === "aBc" (string_append "aB" "c"))

(check === "aBcd" (string_append "aB" (quote c) "d"))
(check === "aB"   (string_append (quote aB) ""))
(check === "aBc"  (string_append (quote aB) "c"))
(check === "aBcd" (string_append (quote aB) "c" (quote d)))


(check === ""    (string_to_lower ""))
(check === "abc" (string_to_lower "AbC"))


(check === ""    (string_to_upper ""))
(check === "ABC" (string_to_upper "AbC"))


//============================================================================
// string_explode, string_implode

(define_check (check_explode str scalars)
  (check === scalars (string_explode str))
  (check === str     (string_implode scalars))
  (check === str     (string_implode (string_explode str)))
  (check === scalars (string_explode (string_implode scalars))))

(check_explode ""                     [])
(check_explode "\0"                   [0])
(check_explode "a B"                  [97, 32, 66])
(check_explode "\u1234"               [0x1234])
(check_explode "\U00100000\U0010FFFF" [0x100000, 0x10FFFF])

// Start with ASCII then switch to supplementary plane.
(check_explode "abc\U00100000"        [97, 98, 99, 0x100000])


//============================================================================
// string_size_utf8

(check === 0  (string_size_utf8 null.string))
(check === 0  (string_size_utf8 ""))
(check === 1  (string_size_utf8 "a"))
(check === 5  (string_size_utf8 "hello"))
(check === 7  (string_size_utf8 "hello\x80"))
(check === 9  (string_size_utf8 "hello\x80\u07ff"))
(check === 12 (string_size_utf8 "hello\x80\u07ff\uffff"))
(check === 16 (string_size_utf8 "hello\x80\u07ff\uffff\U000ffff1"))


//============================================================================
// string_to_symbol

(check === (quote null.symbol) (string_to_symbol null.string))
(check === (quote text)        (string_to_symbol "text"))

// TODO FUSION-204 support empty symbol
(expect_argument_exn (string_to_symbol ""))


//============================================================================
// symbol_to_string

(check === null.string (symbol_to_string (quote null.symbol)))
(check === "text"      (symbol_to_string (quote text)))

// TODO FUSION-204 support empty symbol
