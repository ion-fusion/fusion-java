// Copyright (c) 2013-2014 Amazon.com, Inc.  All rights reserved.

(require
  "/check"
  "/fusion/experimental/string"
  "/fusion/string")


// Here's the bindings we expect to be available:
(module check_bindings '/fusion/string'
  [ is_string,
    string_append, string_to_lower, string_to_symbol, string_to_upper,
  ])


//============================================================================
// Comparisons

(define_check (check_comparisons msg lo hi)                 // msg is rest arg
//  (check <  lo hi)  TODO FUSION-243 string ordering
//  (check <= lo hi)
  (check =  lo lo)
  (check =  hi hi)
//  (check >= hi lo)
//  (check >  hi lo)
)

(check_comparisons ""  "a")
(check_comparisons "a" "b")

(check_comparisons (quote f::"" ) (quote e::"a"))
(check_comparisons (quote f::"a") (quote e::"b"))


//============================================================================
// string_append

(check === (string_append ""   "")  "")
(check === (string_append "aB" "")  "aB")
(check === (string_append "aB" "c") "aBc")

(check === (string_append "aB" (quote c) "d") "aBcd")
(check === (string_append (quote aB) "") "aB")
(check === (string_append (quote aB) "c") "aBc")
(check === (string_append (quote aB) "c" (quote d)) "aBcd")


(check === (string_to_lower "")    "")
(check === (string_to_lower "AbC") "abc")


(check === (string_to_upper "")    "")
(check === (string_to_upper "AbC") "ABC")


//============================================================================
// string_explode, string_implode

(define_check (check_explode msg str scalars)
  (check === (string_explode str) scalars)
  (check === (string_implode scalars) str)
  (check === (string_implode (string_explode str)) str)
  (check === (string_explode (string_implode scalars)) scalars))

(check_explode ""                     [])
(check_explode "\0"                   [0])
(check_explode "a B"                  [97, 32, 66])
(check_explode "\u1234"               [0x1234])
(check_explode "\U00100000\U0010FFFF" [0x100000, 0x10FFFF])

// Start with ASCII then switch to supplementary plane.
(check_explode "abc\U00100000"        [97, 98, 99, 0x100000])


//============================================================================
// string_size_utf8

(check = 0  (string_size_utf8 null.string))
(check = 0  (string_size_utf8 ""))
(check = 1  (string_size_utf8 "a"))
(check = 5  (string_size_utf8 "hello"))
(check = 7  (string_size_utf8 "hello\x80"))
(check = 9  (string_size_utf8 "hello\x80\u07ff"))
(check = 12 (string_size_utf8 "hello\x80\u07ff\uffff"))
(check = 16 (string_size_utf8 "hello\x80\u07ff\uffff\U000ffff1"))


//============================================================================
// string_to_symbol

(check === (string_to_symbol null.string) (quote null.symbol))
(check === (string_to_symbol "text") (quote text))

// TODO FUSION-204 support empty symbol
(check_arg_exn (string_to_symbol ""))


//============================================================================
// symbol_to_string

(check === (symbol_to_string (quote null.symbol)) null.string)
(check === (symbol_to_string (quote text)) "text")

// TODO FUSION-204 support empty symbol
